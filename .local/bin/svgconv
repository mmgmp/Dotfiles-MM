#!/bin/bash

output_file="contactos.vcf"
input_file="$1"

lname="Nombre:"
lphone="Teléfono:"

touch "$output_file"

lines=$(wc -l $1 | awk '{ print $1 }') # Lee las lineas para luego usarlo en el for, para evitar loop infinito.

name=""
phone=""

for ((i = 1; i <= $lines; i++)); do # Analiza todas las lineas
	word=$(sed -n "${i}p" "$input_file" | awk '{ print $1 }')  # Read the current line from the input file
	
	if [ "$word" = "$lname" ]; then # Lee la linea en busca del nombre
		name=$(sed -n "${i}p" "$input_file" | cut -d' ' -f2-)
	elif [ "$word" = "$lphone" ]; then # Lee la linea en busca del teléfono
		phone=$(sed -n "${i}p" "$input_file" | cut -d' ' -f2-)	
	fi
	
	if [ -n "$name" ] && [ -n "$phone" ]; then
        printf "BEGIN:VCARD\nVERSION:4.0\nFN:${name}\nTEL:${phone}\nEND:VCARD\n" >> $output_file
        name=""
        phone=""
    fi
done
