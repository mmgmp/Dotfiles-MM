#!/bin/bash

notify() {    
    volume=$(wpctl get-volume @DEFAULT_AUDIO_SINK@ | tr -dc '0-9' | sed 's/^0\{1,2\}//')
	if [ "$volume" -eq 0 ]; then
		bar="Â·"
	else
		bar=$(seq -s "=" 0 $((volume / 5)) | sed 's/[0-9]//g')
	fi
    notify-send "Volumen: ${volume}%" "$bar" -u low -h string:x-canonical-private-synchronous:volumecontrol -a volume -t 1000 -i $NOTIFY_ICONS/$icon
}

notify_mute() {
	if [ "$mute" -eq 1 ]; then
		notify-send "Volumen: OFF" -u low -h string:x-canonical-private-synchronous:volumecontrol -a volume -t 1000 -i $NOTIFY_ICONS/$icon
	else
		notify
	fi
}

icon_select() {
	if [ "$mute" -eq 1 ]; then
		icon=volume-xmark-solid.svg
	else
		icon=volume-low-solid.svg
	fi
}

mute_check() {
	if wpctl get-volume @DEFAULT_AUDIO_SINK@ | grep -q "MUTED"; then
		mute=1
	else
		mute=0
	fi
}

case $1 in
	up)
		wpctl set-volume -l 1.0 @DEFAULT_AUDIO_SINK@ 5%+
		mute_check
		icon_select
		notify ;;

	down)
		wpctl set-volume -l 1.0 @DEFAULT_AUDIO_SINK@ 5%-
		mute_check
		icon_select
		notify ;;

	mute)
		wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
		mute_check
		icon_select
		notify_mute ;;
esac
